<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Sindical - Reportes y Gesti贸n</title>
    
    <!-- Librer铆as Externas -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Enlaces MVC -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div id="loading" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <!-- VISTA INICIO / CONSULTA -->
    <div id="view-home" class="container" style="display: block;">
        <header class="header">
            <h1>CONTROL SINDICAL</h1>
            <p>Consulta de Afiliados y Estado de Cuentas</p>
        </header>

        <div class="search-box">
            <input type="text" id="search-input" placeholder="Nombre completo del socio..." onkeyup="handleSearch(event)">
            <button onclick="searchSocio()">Consultar</button>
        </div>

        <div id="home-results"></div>

        <div class="footer-pingu" onclick="openLoginModal()"></div>
    </div>

    <!-- VISTA ADMINISTRACIN -->
    <div id="view-admin" class="container">
        <header class="header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1 id="admin-title">Panel Administrativo</h1>
                    <p>Sindicato de Transportes</p>
                </div>
                <button class="logout-btn" onclick="logout()">Cerrar Sesi贸n</button>
            </div>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('socios')">SOCIOS</button>
            <button class="tab-btn" onclick="switchTab('pagos')">PAGOS</button>
            <button class="tab-btn" onclick="switchTab('reportes')">REPORTES</button>
            <button class="tab-btn" onclick="switchTab('config')">CONFIG</button>
        </div>

        <!-- Pesta帽a Socios -->
        <div id="tab-socios" class="tab-content active">
            <div class="card">
                <h3>Registro de Nuevo Socio</h3>
                <div class="search-box" style="margin-top: 15px;">
                    <input type="text" id="new-socio-name" placeholder="Nombre completo...">
                    <button onclick="addSocio()">Registrar</button>
                </div>
            </div>
            <div id="socios-list"></div>
        </div>

        <!-- Pesta帽a Pagos -->
        <div id="tab-pagos" class="tab-content">
            <div class="card">
                <h3>Registrar Pago de Mensualidades</h3>
                <div class="search-box" style="margin-top: 15px; flex-direction: column; gap: 15px;">
                    <select id="pay-socio-select" style="width: 100%; padding: 10px; background: #111; color: white; border: 1px solid #333; border-radius: 5px;"></select>
                    <div style="display: flex; gap: 10px; width: 100%;">
                        <div style="flex: 1;">
                            <label style="font-size: 12px; color: #666;">Meses a Pagar</label>
                            <input type="number" id="pay-qty" value="1" min="1" oninput="updatePayDisplay()" style="width: 100%; padding: 10px; background: #111; color: white; border: 1px solid #333; border-radius: 5px;">
                        </div>
                        <div style="flex: 1;">
                            <label style="font-size: 12px; color: #666;">Monto Total (Bs)</label>
                            <input type="text" id="pay-amount" readonly style="width: 100%; padding: 10px; background: #111; color: white; border: 1px solid #333; border-radius: 5px; opacity: 0.7;">
                        </div>
                    </div>
                    <button onclick="processPayment()" style="width: 100%;">Confirmar Pago</button>
                </div>
            </div>
            <div id="recent-payments"></div>
        </div>

        <!-- Pesta帽a Reportes -->
        <div id="tab-reportes" class="tab-content">
            <div class="card no-print">
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button id="btn-rep-ind" class="tab-btn active" onclick="switchReportSubTab('individual')">Individual</button>
                    <button id="btn-rep-gen" class="tab-btn" onclick="switchReportSubTab('general')">General</button>
                </div>

                <div id="sub-tab-individual">
                    <select id="report-socio-select" onchange="generateIndividualReport()" style="width: 100%; padding: 10px; background: #111; color: white; border: 1px solid #333; border-radius: 5px;"></select>
                </div>

                <div id="sub-tab-general" style="display: none;">
                    <button onclick="generateGeneralReport()" style="width: 100%;">Generar Lista de Deudores</button>
                </div>
            </div>

            <div id="report-content" class="card" style="background: white; color: black; min-height: 400px; padding: 40px; border-radius: 0;">
                <div style="text-align: center; color: #888; margin-top: 100px;">Seleccione un socio para generar reporte</div>
            </div>
            
            <button class="no-print" onclick="printReport()" style="width: 100%; margin-top: 20px; background: #333;">Imprimir / Guardar PDF</button>
        </div>

        <!-- Pesta帽a Config -->
        <div id="tab-config" class="tab-content">
            <div class="card">
                <h3>Configuraci贸n de Gesti贸n</h3>
                <div style="margin-top: 15px; display: flex; flex-direction: column; gap: 15px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <label style="font-size: 12px; color: #666;">A帽o Gesti贸n</label>
                            <input type="number" id="conf-year" value="2024" style="width: 100%; padding: 10px; background: #111; color: white; border: 1px solid #333; border-radius: 5px;">
                        </div>
                        <div>
                            <label style="font-size: 12px; color: #666;">Monto Mensual (Bs)</label>
                            <input type="number" id="conf-price" value="10" style="width: 100%; padding: 10px; background: #111; color: white; border: 1px solid #333; border-radius: 5px;">
                        </div>
                    </div>
                    <button onclick="saveConfig()">Actualizar Configuraci贸n</button>
                </div>
            </div>
            
            <div class="card" style="margin-top: 20px;">
                <h3>Avisos a la Pantalla de Inicio</h3>
                <textarea id="conf-aviso" placeholder="Escribe un comunicado..." style="width: 100%; height: 100px; margin-top: 15px; padding: 10px; background: #111; color: white; border: 1px solid #333; border-radius: 5px; resize: none;"></textarea>
                <button onclick="saveAviso()" style="width: 100%; margin-top: 10px; background: #333;">Publicar Aviso</button>
            </div>
        </div>
    </div>

    <!-- Modales -->
    <div id="login-modal" class="modal-overlay">
        <div class="modal">
            <h3>Acceso Administrativo</h3>
            <input type="email" id="login-email" placeholder="Correo electr贸nico" style="width: 100%; margin: 10px 0; padding: 12px; background: #111; color: white; border: 1px solid #333; border-radius: 5px;">
            <input type="password" id="login-pass" placeholder="Contrase帽a" style="width: 100%; margin: 10px 0; padding: 12px; background: #111; color: white; border: 1px solid #333; border-radius: 5px;">
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button onclick="login()" style="flex: 2;">Ingresar</button>
                <button onclick="closeLoginModal()" style="flex: 1; background: #333;">Cerrar</button>
            </div>
        </div>
    </div>

    <div id="modal-overlay" class="modal-overlay">
        <div class="modal">
            <h3>Editar Socio</h3>
            <input type="text" id="modal-edit-input" style="width: 100%; margin: 20px 0; padding: 12px; background: #111; color: white; border: 1px solid #333; border-radius: 5px;">
            <div style="display: flex; gap: 10px;">
                <button onclick="saveEditSocio()" style="flex: 1;">Guardar Cambios</button>
                <button onclick="closeModal()" style="flex: 1; background: #333;">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <!-- Archivos MVC -->
    <script src="model.js"></script>
    <script src="controller.js"></script>
</body>
</html>
